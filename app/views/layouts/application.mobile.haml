-#   Copyright (c) 2010, Diaspora Inc.  This file is
-#   licensed under the Affero General Public License version 3 or later.  See
-#   the COPYRIGHT file.

!!!
%html{:lang => I18n.locale.to_s, :dir => (rtl?) ? 'rtl' : 'ltr'}
  %head
    %title
      DIASPORA*
    %meta{"http-equiv"=>"Content-Type", :content=>"text/html; charset=utf-8"}/
    %meta{:name => "viewport", :content=>"width=device-width, initial-scale=1.0, maximum-scale=1.0"}
    %meta{:name=>"apple-touch-fullscreen", :content=>"yes"}
    %meta{:name=>"apple-mobile-web-app-capable", :content=>"yes"}

    = include_javascripts :mobile
    -if current_user
      :javascript
        Diaspora.widgets.i18n.loadLocale(#{get_javascript_strings_for(current_user.language).to_json}, "#{current_user.language}");

    = csrf_meta_tag

    = include_stylesheets :mobile, :media => 'all'
    
    - if rtl?
      = include_stylesheets :rtl, :media => 'all'

    = yield(:head)

  %body
    %header
      #nav
        = link_to(image_tag('/images/asterisk_mobile_white.png', :height => 30, :width => 30, :id => 'asterisk-logo'), "/#aspects", :class => 'nav-element')
        = link_to(image_tag('/images/icons/mail_mobile_white.png', :height => 30, :width => 30), "/#conversations", :class => 'nav-element dimmed')

    #content
      = yield

    -if AppConfig[:google_a_site]
      :javascript
        var _gaq=[['_setAccount','#{AppConfig[:google_a_site]}'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));

    -if AppConfig[:piwik_id]
      :javascript
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://#{AppConfig[:piwik_url]}/" : "http://#{AppConfig[:piwik_url]}/");
        document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
      :javascript
        try {
        var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", #{AppConfig[:piwik_id]});
        piwikTracker.trackPageView();
        piwikTracker.enableLinkTracking();
        } catch( err ) {}

